function openFlowSheet() {
    window.open('FlowSheet.html', '_blank');
}

function toggleSettingsMenu() {
    const settingsIcon = document.querySelector('.settings-icon');
    const settingsMenu = document.querySelector('.settings-menu');
    settingsIcon.classList.add('spin');
    settingsMenu.classList.toggle('show');
    setTimeout(() => {
        settingsIcon.classList.remove('spin');
    }, 500);
}

function toggleTheme() {
    document.body.classList.toggle('dark-theme');
    localStorage.setItem('theme', document.body.classList.contains('dark-theme') ? 'dark' : 'light');
}

function showInfo(type) {
    const modal = document.getElementById(type + 'Modal');
    modal.style.display = 'block';
}

function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    modal.style.display = 'none';
}

function showSubInfo(subType) {
    const subInfos = document.querySelectorAll('.sub-info');
    subInfos.forEach(info => info.style.display = 'none');
    const subInfo = document.getElementById(subType + 'Info');
    subInfo.style.display = 'block';
}

function acceptCookies() {
    document.getElementById('cookie-consent').style.display = 'none';
    localStorage.setItem('cookiesAccepted', 'true');
}

// Check for saved theme preference
const savedTheme = localStorage.getItem('theme');
if (savedTheme === 'dark') {
    document.body.classList.add('dark-theme');
    document.getElementById('themeToggle').checked = true;
}

// Check for cookie consent
if (!localStorage.getItem('cookiesAccepted')) {
    document.getElementById('cookie-consent').style.display = 'block';
}

// Close settings menu and modals when clicking outside
window.onclick = function(event) {
    const settingsIcon = document.querySelector('.settings-icon');
    const settingsMenu = document.querySelector('.settings-menu');
    const modals = document.getElementsByClassName('modal');

    if (!settingsIcon.contains(event.target) && !settingsMenu.contains(event.target)) {
        settingsMenu.classList.remove('show');
    }

    for (let modal of modals) {
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    }
}

// Add smooth scrolling for iOS devices
document.addEventListener('touchmove', function(e) { e.preventDefault(); }, { passive: false });

// Add Apple-style animations
const animateOnScroll = () => {
    const elements = document.querySelectorAll('.animate-on-scroll');
    elements.forEach(el => {
        const rect = el.getBoundingClientRect();
        const windowHeight = window.innerHeight || document.documentElement.clientHeight;
        if (rect.top <= windowHeight * 0.75) {
            el.classList.add('animate');
        }
    });
};

window.addEventListener('scroll', animateOnScroll);
window.addEventListener('resize', animateOnScroll);
window.addEventListener('load', animateOnScroll);
